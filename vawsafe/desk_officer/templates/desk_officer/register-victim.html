{% extends 'base.html' %}
{% load widget_tweaks %}

{% block content %}
<h1 class="text-center">Register Victim Page</h1>

<form method="post" class="space-y-6 p-6 bg-white rounded-xl shadow-md">
    {% csrf_token %}

    <div class="border border-gray-300 rounded-xl p-6 bg-gray-50 shadow">
        <h2 class="text-2xl font-semibold mb-6 text-blue-800">Victim/Survivor Information</h2>

        <!-- Grouped name fields in 3-column grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div>
                <label class="block font-medium text-gray-700 mb-1">{{ victim_form.first_name.label }}</label>
                {{ victim_form.first_name|add_class:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-400" }}
            </div>
            <div>
                <label class="block font-medium text-gray-700 mb-1">{{ victim_form.last_name.label }}</label>
                {{ victim_form.last_name|add_class:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-400" }}
            </div>
            <div>
                <label class="block font-medium text-gray-700 mb-1">{{ victim_form.middle_name.label }}</label>
                {{ victim_form.middle_name|add_class:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-400" }}
            </div>
        </div>

        <!-- Remaining fields in a 2-column grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% for field in victim_form %}
                {% if field.name not in "first_name last_name middle_name" %}
                    <div>
                        <label class="block font-medium text-gray-700 mb-1">{{ field.label }}</label>
                        {{ field|add_class:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-400" }}
                        {% if field.help_text %}
                            <p class="text-sm text-gray-500">{{ field.help_text }}</p>
                        {% endif %}
                        {% for error in field.errors %}
                            <p class="text-sm text-red-600">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div class="border border-gray-300 rounded-xl p-4">
        <h2 class="text-xl font-semibold mb-4">Incident Information</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            {% for field in incident_form %}
                {% if field.name not in "is_conflict_area conflict_area is_via_electronic_means electronic_means" %}
                    <div>
                        <label class="block font-medium text-gray-700 mb-1">{{ field.label }}</label>
                        {{ field|add_class:"w-full p-2 border rounded-md" }}
                    </div>
                {% endif %}
            {% endfor %}
            
            <div>
                <!-- is_conflict_area Checkbox -->
                <div>
                    <label class="block font-medium text-gray-700 mb-1">
                        {{ incident_form.is_conflict_area.label }}
                    </label>
                    {{ incident_form.is_conflict_area|add_class:"w-4 h-4" }}
                </div>
    
                <!-- conflict_area Dropdown -->
                <div id="conflictAreaGroup" class="hidden">
                    <label class="block font-medium text-gray-700 mb-1">
                        {{ incident_form.conflict_area.label }}
                    </label>
                    {{ incident_form.conflict_area|add_class:"w-full p-2 border rounded-md" }}
                </div>
    
                <!-- If conflict_area is Others, show this -->
                <div id="conflictAreaOtherGroup" class="hidden">
                    <label for="conflict_area_other" class="block font-medium text-gray-700 mb-1">Specify Conflict Area</label>
                    <input type="text" name="conflict_area_other" id="conflict_area_other"
                        class="w-full p-2 border rounded-md" placeholder="Enter conflict area">
                </div>
            </div>

            <div></div>
            
            <div>
                <!-- is_via_electronic_means Checkbox -->
                <div>
                    <label class="block font-medium text-gray-700 mb-1">
                        {{ incident_form.is_via_electronic_means.label }}
                    </label>
                    {{ incident_form.is_via_electronic_means|add_class:"w-4 h-4" }}
                </div>
    
                <!-- electronic_means_description input (hidden initially) -->
                <div id="electronicMeansDescriptionGroup" class="hidden">
                    <label for="electronic_means_description" class="block font-medium text-gray-700 mb-1">
                        Specify Electronic Means
                    </label>
                    {{ incident_form.electronic_means|add_class:"w-full p-2 border rounded-md" }}
                </div>
            </div>

        </div>
    </div>


    <div class="border border-gray-300 rounded-xl p-4">
    <h2 class="text-xl font-semibold mb-4">Alleged Perpetrator Information</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% for field in perpetrator_form %}
                <div>
                    <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        {{ field.label }}
                    </label>
                    {{ field|add_class:"w-full p-2 border border-gray-300 rounded-md" }}
                    {% if field.help_text %}
                        <p class="text-xs text-gray-500">{{ field.help_text }}</p>
                    {% endif %}
                    {% if field.errors %}
                        <p class="text-sm text-red-600">{{ field.errors }}</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>


    <div class="text-right">
        <input type="submit" value="Submit" class="btn btn-primary px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">
    </div>
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // Conflict area logic
    const isConflictCheckbox = document.getElementById("id_is_conflict_area");
    const conflictAreaSelect = document.getElementById("id_conflict_area");
    const conflictAreaGroup = document.getElementById("conflictAreaGroup");
    const conflictAreaOtherGroup = document.getElementById("conflictAreaOtherGroup");

    function toggleConflictFields() {
        const showConflict = isConflictCheckbox.checked;
        conflictAreaGroup.style.display = showConflict ? "block" : "none";
        conflictAreaOtherGroup.style.display = (showConflict && conflictAreaSelect.value === "Others") ? "block" : "none";
    }

    isConflictCheckbox.addEventListener("change", toggleConflictFields);
    conflictAreaSelect.addEventListener("change", toggleConflictFields);
    toggleConflictFields();  // Initial check

    // Electronic means logic
    const isElectronicCheckbox = document.getElementById("id_is_via_electronic_means");
    const electronicMeansGroup = document.getElementById("electronicMeansDescriptionGroup");

    function toggleElectronicField() {
        electronicMeansGroup.style.display = isElectronicCheckbox.checked ? "block" : "none";
    }

    isElectronicCheckbox.addEventListener("change", toggleElectronicField);
    toggleElectronicField();  // Initial check
});
</script>



{% endblock %}